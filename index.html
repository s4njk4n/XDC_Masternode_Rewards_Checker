<!DOCTYPE html>
<html lang="en" class="transition-colors duration-300">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XDC Masternode Rewards Calculator</title>
    <!-- MIT License -->
    <meta name="license" content="MIT">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(180deg, #2E2A6A 0%, #4A3E8A 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --text: #F3E8FF;
            --text-secondary: #E2D1F9;
            --text-muted: #D4C2F0;
            --border: rgba(255, 255, 255, 0.15);
            --input-bg: #2E2A6A;
            --btn-bg: #2E2A6A;
            --btn-text: #A3E4FF;
            --success: #6EE7B7;
            --error: #FCA5A5;
            --nav-bg: rgba(46, 42, 106, 0.7);
        }
        [data-theme="dark"] {
            --bg-gradient: linear-gradient(180deg, #0f0f23 0%, #1a1a2e 100%);
            --card-bg: rgba(255, 255, 255, 0.05);
            --text: #e0e0ff;
            --text-secondary: #c0c0ff;
            --text-muted: #a0a0d0;
            --border: rgba(255, 255, 255, 0.1);
            --input-bg: #1a1a2e;
            --btn-bg: #1a1a2e;
            --btn-text: #a0a0ff;
            --nav-bg: rgba(26, 26, 46, 0.7);
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            margin: 0;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            backdrop-filter: blur(6px);
            border-radius: 20px;
            padding: 1.25rem;
        }
        input, textarea {
            background: var(--input-bg);
            color: var(--text);
            border: 1px solid var(--border);
        }
        .btn {
            background: var(--btn-bg);
            color: var(--btn-text);
            border: 1px solid var(--border);
        }
        .success { color: var(--success); }
        .error { color: var(--error); }
        .hidden { display: none; }
        .link { 
            color: #A3E4FF; 
            text-decoration: underline; 
            font-size: 0.75rem; 
            display: inline-block;
            margin-right: auto;
        }
        .link:hover { text-decoration: none; }
        .footer-links {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-size: 0.75rem;
        }
        #hero {
            position: relative;
        }
        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--text-muted);
            border-radius: 50%;
            opacity: 0.2;
            pointer-events: none;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(163, 228, 255, 0.2);
            transition: all 0.3s ease;
        }
        .optional-text {
            font-size: 0.875rem; /* text-sm */
            color: var(--text-muted);
        }
        #output {
            margin-top: 20px;
            white-space: pre-wrap;
            background-color: var(--input-bg);
            padding: 10px;
            border: 1px solid var(--border);
            max-height: 400px;
            overflow-y: auto;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <div class="fixed top-4 right-4 z-50">
        <button onclick="toggleTheme()" class="bg-[#2E2A6A] text-[#A3E4FF] p-2 rounded-full hover:bg-[#3A3570] transition-all">
            <i id="themeIcon" class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="py-6 px-6 sticky top-0 z-40 bg-opacity-70 backdrop-blur-md" style="background: var(--nav-bg);">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-[#F3E8FF] max-sm:text-xl">XDC Masternode Rewards Calculator</h1>
            <div class="nav-items space-x-8 max-sm:space-x-4 flex items-center">
                <a href="https://github.com/s4njk4n/XDC_Masternode_Rewards_Checker" target="_blank" class="text-[#A3E4FF] hover:text-white font-medium text-lg max-sm:text-sm flex items-center gap-1.5 whitespace-nowrap"><i class="fas fa-book-open text-sm"></i><span>Instructions</span></a>
                <a href="https://s4njk4n.github.io/XDCOutpost/" class="text-[#F3E8FF] hover:text-[#A3E4FF] text-lg max-sm:text-sm">Back to Outpost</a>
                <a href="#contact" class="text-[#F3E8FF] hover:text-[#A3E4FF] text-lg max-sm:text-sm">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero">
        <div id="background">
            <div id="particles"></div>
        </div>
        <div class="max-w-5xl mx-auto p-6">
            <p class="text-xl md:text-2xl text-[#E2D1F9] mb-12 max-sm:text-base">Calculate inferred masternode rewards on the XDC Network for a given address and time period. (In beta testing)</p>

            <!-- Calculator Card -->
            <div class="card hover-effect max-w-lg mx-auto mb-8 p-6">
                <h2 class="text-2xl font-bold text-[#A3E4FF] mb-4">Calculate Rewards</h2>
                <form id="inputForm">
                    <label for="rpcUrl" class="text-sm text-[#D4C2F0] mb-2 block">RPC URL (default: https://rpc.ankr.com/xdc):</label>
                    <input type="text" id="rpcUrl" placeholder="https://rpc.ankr.com/xdc" class="w-full p-3 mb-4 rounded-lg bg-[#2E2A6A] text-[#F3E8FF] border border-[#A3E4FF]/30 focus:outline-none max-sm:text-sm">

                    <label for="startDate" class="text-sm text-[#D4C2F0] mb-2 block">Start Date (YYYY-MM-DD):</label>
                    <input type="text" id="startDate" required pattern="\d{4}-\d{2}-\d{2}" placeholder="YYYY-MM-DD" class="w-full p-3 mb-4 rounded-lg bg-[#2E2A6A] text-[#F3E8FF] border border-[#A3E4FF]/30 focus:outline-none max-sm:text-sm">

                    <label for="endDate" class="text-sm text-[#D4C2F0] mb-2 block">End Date (YYYY-MM-DD):</label>
                    <input type="text" id="endDate" required pattern="\d{4}-\d{2}-\d{2}" placeholder="YYYY-MM-DD" class="w-full p-3 mb-4 rounded-lg bg-[#2E2A6A] text-[#F3E8FF] border border-[#A3E4FF]/30 focus:outline-none max-sm:text-sm">

                    <label for="ownerAddr" class="text-sm text-[#D4C2F0] mb-2 block">Masternode Owner Address (0x... or xdc...):</label>
                    <input type="text" id="ownerAddr" required placeholder="e.g., xdc..." class="w-full p-3 mb-4 rounded-lg bg-[#2E2A6A] text-[#F3E8FF] border border-[#A3E4FF]/30 focus:outline-none max-sm:text-sm">

                    <label for="apiKey" class="text-sm text-[#D4C2F0] mb-2 block">Etherscan API Key (*See Instructions Link at Top of Page):</label>
                    <input type="text" id="apiKey" required class="w-full p-3 mb-6 rounded-lg bg-[#2E2A6A] text-[#F3E8FF] border border-[#A3E4FF]/30 focus:outline-none max-sm:text-sm">

                    <button type="submit" class="w-full bg-gradient-to-r from-[#A3E4FF] to-[#FFD1DC] text-[#2E2A6A] font-semibold py-3 px-6 rounded-full hover-effect max-sm:py-2 max-sm:text-sm">Calculate Rewards</button>
                </form>
                <div id="output"></div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="pt-20 pb-4 px-6">
        <div class="max-w-5xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold text-[#A3E4FF] mb-12 max-sm:text-2xl">Connect</h2>
            <p class="text-[#E2D1F9] mb-8 text-lg max-sm:text-sm">Have questions or need support for XDC Sentinel or other services? Reach out to me on your preferred platform:</p>
            <div class="social-links flex justify-center flex-wrap gap-8 max-sm:gap-4">
                <a href="https://t.me/s4njk4n" target="_blank" class="social-icon text-3xl max-sm:text-xl" aria-label="Contact us on Telegram" title="Contact us on Telegram (@s4njk4n)">
                    <i class="fa-brands fa-telegram"></i> <span class="text-lg max-sm:text-sm ml-2">Telegram: @s4njk4n</span>
                </a>
                <a href="https://discord.com/users/852434672793288724" target="_blank" class="social-icon text-3xl max-sm:text-xl" aria-label="Contact us on Discord" title="Contact us on Discord (@s4njk4n)">
                    <i class="fa-brands fa-discord"></i> <span class="text-lg max-sm:text-sm ml-2">Discord: @s4njk4n</span>
                </a>
                <a href="https://x.com/s4njk4n" target="_blank" class="social-icon text-3xl max-sm:text-xl" aria-label="Visit our X profile" title="Visit our X profile (@s4njk4n)">
                    <i class="fa-brands fa-x-twitter"></i> <span class="text-lg max-sm:text-sm ml-2">X: @s4njk4n</span>
                </a>
                <a href="https://github.com/s4njk4n" target="_blank" class="social-icon text-3xl max-sm:text-xl" aria-label="Visit our GitHub profile" title="Visit our GitHub profile (s4njk4n)">
                    <i class="fa-brands fa-github"></i> <span class="text-lg max-sm:text-sm ml-2">GitHub: s4njk4n</span>
                </a>
            </div>
        </div>
    </section>

<!-- Footer -->
<footer class="py-10 px-6 text-center text-[#D4C2F0]">
  <p class="max-sm:text-sm">Â© 2025 XDC Outpost. All rights reserved. Powered by <a href="https://github.com/s4njk4n?tab=repositories" target="_blank" class="text-[#A3E4FF] hover:underline">s4njk4n</a>.</p>
  <p class="mt-2">
    
        <a href="https://www.hitwebcounter.com/" target="_blank">
      <img src="https://hitwebcounter.com/counter/counter.php?page=21459236&style=0038&nbdigits=5&type=page&initCount=0" title="Free Tools" alt="Free Tools" border="0" style="display: block; margin: 0 auto;" />
    </a>
  </p>    
</footer>

    <script>
        // === Theme Toggle ===
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('themeIcon');
            if (html.hasAttribute('data-theme')) {
                html.removeAttribute('data-theme');
                icon.classList.replace('fa-sun', 'fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.classList.replace('fa-moon', 'fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        }
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('themeIcon').classList.replace('fa-moon', 'fa-sun');
        }

        // === Animations ===
        const particlesContainer = document.getElementById('particles');
        function initParticles() {
            for (let i = 0; i < 30; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = `${Math.random() * 100}%`;
                p.style.top = `${Math.random() * 100}%`;
                p.style.animation = `float ${5 + Math.random() * 3}s infinite`;
                particlesContainer.appendChild(p);
            }
        }
        initParticles();

        function randomizeClouds() {
            const bg = document.querySelector('#background');
            const rand = () => 20 + Math.random() * 60;
            bg.style.setProperty('--cloud1-left', `${rand()}%`);
            bg.style.setProperty('--cloud2-left', `${rand()}%`);
            bg.style.setProperty('--cloud1-top', `${rand()}%`);
            bg.style.setProperty('--cloud2-top', `${rand()}%`);
        }
        randomizeClouds();
        setInterval(randomizeClouds, 10000);

        window.onload = () => {
            initParticles();
            randomizeClouds();
            setInterval(randomizeClouds, 10000);
        };

        // Calculator Script
        // Convert xdc prefix to 0x
        function convertAddress(addr) {
            return addr.startsWith('xdc') ? '0x' + addr.slice(3) : addr;
        }

        // Validate date format (YYYY-MM-DD)
        function validateDate(dateStr) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            return regex.test(dateStr);
        }

        // Convert hex to decimal
        function hexToDec(hex) {
            if (hex.startsWith('0x')) {
                return BigInt(hex).toString();
            }
            return hex; // Already decimal
        }

        // Format wei to XDC
        function weiToXdc(wei) {
            const bigWei = BigInt(wei);
            const integerPart = (bigWei / BigInt(1000000000000000000n)).toString();
            const fractionalPart = (bigWei % BigInt(1000000000000000000n)).toString().padStart(18, '0').replace(/0+$/, '');
            return fractionalPart ? `${integerPart}.${fractionalPart}` : integerPart;
        }

        // RPC call helper with improved error handling
        async function rpcCall(url, method, params) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jsonrpc: '2.0', method, params, id: 1 })
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, Body: ${errorText}`);
                }
                const data = await response.json();
                if (data.error) {
                    throw new Error(`RPC Error: ${data.error.message} (code: ${data.error.code})`);
                }
                return data.result;
            } catch (e) {
                console.error('RPC Call error:', e);
                throw new Error(`RPC Call to ${method} failed: ${e.message}`);
            }
        }

        // Etherscan API call helper (using v2)
        async function etherscanCall(params, apiKey) {
            const url = `https://api.etherscan.io/v2/api?${params}&apikey=${apiKey}&chainid=50`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, Body: ${errorText}`);
                }
                const data = await response.json();
                if (data.status === '1') {
                    return data.result;
                } else if (data.status === '0' && (data.message === 'No transactions found' || data.message === 'NOTOK' && data.result === 'No transactions found')) {
                    return [];
                } else {
                    throw new Error(`Etherscan Error: ${data.message || 'Unknown error'}`);
                }
            } catch (e) {
                console.error('Etherscan Call error:', e);
                throw new Error(`Etherscan Call failed: ${e.message}`);
            }
        }

        // Binary search for first block >= targetTimestamp
        async function findFirstBlockGeTimestamp(rpcUrl, targetTimestamp, latestBlock, output) {
            let low = 0;
            let high = parseInt(latestBlock, 16);
            output.textContent += `Initiating binary search for first block >= ${targetTimestamp}: low=${low}, high=${high}\n`;
            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                const blockHex = '0x' + mid.toString(16);
                output.textContent += `Checking mid block ${mid} (${blockHex})...\n`;
                const block = await rpcCall(rpcUrl, 'eth_getBlockByNumber', [blockHex, false]);
                const blockTimestamp = parseInt(block.timestamp, 16);
                output.textContent += `Block ${mid} timestamp: ${blockTimestamp} (${new Date(blockTimestamp * 1000).toISOString()})\n`;
                if (blockTimestamp < targetTimestamp) {
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            output.textContent += `Binary search completed. First block >= timestamp: ${low}\n`;
            return low;
        }

        // Binary search for last block <= targetTimestamp
        async function findLastBlockLeTimestamp(rpcUrl, targetTimestamp, latestBlock, output) {
            let low = 0;
            let high = parseInt(latestBlock, 16);
            output.textContent += `Initiating binary search for last block <= ${targetTimestamp}: low=${low}, high=${high}\n`;
            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                const blockHex = '0x' + mid.toString(16);
                output.textContent += `Checking mid block ${mid} (${blockHex})...\n`;
                const block = await rpcCall(rpcUrl, 'eth_getBlockByNumber', [blockHex, false]);
                const blockTimestamp = parseInt(block.timestamp, 16);
                output.textContent += `Block ${mid} timestamp: ${blockTimestamp} (${new Date(blockTimestamp * 1000).toISOString()})\n`;
                if (blockTimestamp <= targetTimestamp) {
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            output.textContent += `Binary search completed. Last block <= timestamp: ${high}\n`;
            return high;
        }

        // Main calculation function
        async function calculateRewards(event) {
            event.preventDefault();
            const output = document.getElementById('output');
            output.textContent = 'Starting calculation...\n';
            output.classList.remove('error');
            try {
                const rpcUrl = document.getElementById('rpcUrl').value || 'https://rpc.ankr.com/xdc';
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                let ownerAddr = document.getElementById('ownerAddr').value;
                const apiKey = document.getElementById('apiKey').value;

                // Validate inputs
                if (!validateDate(startDate) || !validateDate(endDate)) throw new Error('Invalid date format. Use YYYY-MM-DD');
                ownerAddr = convertAddress(ownerAddr).toLowerCase();
                if (!/^0x[a-f0-9]{40}$/.test(ownerAddr)) throw new Error('Invalid address format');
                if (!apiKey) throw new Error('Etherscan API Key is required');

                output.textContent += `Using RPC: ${rpcUrl}\n`;
                output.textContent += `Address: ${ownerAddr}\n`;
                output.textContent += `Period: ${startDate} to ${endDate}\n`;

                // Convert dates to timestamps
                const startTimestamp = Math.floor(new Date(startDate).getTime() / 1000);
                const endTimestamp = Math.floor(new Date(endDate + 'T23:59:59.999Z').getTime() / 1000);
                output.textContent += `Start Timestamp: ${startTimestamp} (${new Date(startTimestamp * 1000).toISOString()})\n`;
                output.textContent += `End Timestamp: ${endTimestamp} (${new Date(endTimestamp * 1000).toISOString()})\n`;

                // Get latest block
                output.textContent += 'Fetching latest block number...\n';
                const latestBlock = await rpcCall(rpcUrl, 'eth_blockNumber', []);
                output.textContent += `Latest block: ${parseInt(latestBlock, 16)} (hex: ${latestBlock})\n`;

                // Find start and end blocks
                output.textContent += 'Searching for start block (first >= start timestamp)...\n';
                const firstPeriodBlock = await findFirstBlockGeTimestamp(rpcUrl, startTimestamp, latestBlock, output);
                let startBalanceBlock = firstPeriodBlock - 1;
                if (startBalanceBlock < 0) startBalanceBlock = 0;

                output.textContent += 'Searching for end block (last <= end timestamp)...\n';
                const endBlock = await findLastBlockLeTimestamp(rpcUrl, endTimestamp, latestBlock, output);

                // Verify timestamps
                const firstBlockHex = '0x' + firstPeriodBlock.toString(16);
                const firstBlock = await rpcCall(rpcUrl, 'eth_getBlockByNumber', [firstBlockHex, false]);
                const firstTs = parseInt(firstBlock.timestamp, 16);
                output.textContent += `Verified first period block ${firstPeriodBlock} timestamp: ${firstTs} (${new Date(firstTs * 1000).toISOString()})\n`;

                const endBlockHex = '0x' + endBlock.toString(16);
                const endBlockInfo = await rpcCall(rpcUrl, 'eth_getBlockByNumber', [endBlockHex, false]);
                const endTs = parseInt(endBlockInfo.timestamp, 16);
                output.textContent += `Verified end block ${endBlock} timestamp: ${endTs} (${new Date(endTs * 1000).toISOString()})\n`;

                // Get balances
                const startBalanceBlockHex = '0x' + startBalanceBlock.toString(16);
                output.textContent += `Fetching starting balance at block ${startBalanceBlock} (${startBalanceBlockHex})...\n`;
                const startBalance = await rpcCall(rpcUrl, 'eth_getBalance', [ownerAddr, startBalanceBlockHex]);
                const startBalanceDec = hexToDec(startBalance);
                output.textContent += `Starting balance: ${startBalance} (hex), ${startBalanceDec} (wei), ${weiToXdc(startBalanceDec)} XDC\n`;

                output.textContent += `Fetching ending balance at block ${endBlock} (${endBlockHex})...\n`;
                const endBalance = await rpcCall(rpcUrl, 'eth_getBalance', [ownerAddr, endBlockHex]);
                const endBalanceDec = hexToDec(endBalance);
                output.textContent += `Ending balance: ${endBalance} (hex), ${endBalanceDec} (wei), ${weiToXdc(endBalanceDec)} XDC\n`;

                // Calculate transactions (from firstPeriodBlock to endBlock)
                let transfersIn = 0n;
                let transfersOut = 0n;
                let totalFees = 0n;
                const offset = 10000;

                // Normal transactions
                let page = 1;
                output.textContent += 'Fetching normal transactions...\n';
                while (true) {
                    output.textContent += `Fetching normal transactions page ${page}...\n`;
                    const params = `module=account&action=txlist&address=${ownerAddr}&startblock=${firstPeriodBlock}&endblock=${endBlock}&page=${page}&offset=${offset}&sort=asc`;
                    const txs = await etherscanCall(params, apiKey);
                    if (!txs || txs.length === 0) {
                        output.textContent += `No more normal transactions on page ${page}.\n`;
                        break;
                    }
                    output.textContent += `Received ${txs.length} normal transactions on page ${page}.\n`;

                    for (const tx of txs) {
                        const valueDec = BigInt(tx.value);
                        const gasUsedDec = BigInt(tx.gasUsed);
                        const gasPriceDec = BigInt(tx.gasPrice);
                        output.textContent += `- Hash: ${tx.hash}, From: ${tx.from}, To: ${tx.to}, Value: ${valueDec} wei, Gas Used: ${gasUsedDec}, Gas Price: ${gasPriceDec} wei\n`;

                        if (tx.to && tx.to.toLowerCase() === ownerAddr) {
                            transfersIn += valueDec;
                            output.textContent += `  Incoming: ${weiToXdc(valueDec)} XDC, Running Total In: ${weiToXdc(transfersIn)}\n`;
                        }
                        if (tx.from.toLowerCase() === ownerAddr) {
                            transfersOut += valueDec;
                            const fee = gasUsedDec * gasPriceDec;
                            totalFees += fee;
                            output.textContent += `  Outgoing: ${weiToXdc(valueDec)} XDC, Fee: ${weiToXdc(fee)} XDC, Running Total Out: ${weiToXdc(transfersOut)}, Running Total Fees: ${weiToXdc(totalFees)}\n`;
                        }
                    }
                    if (txs.length < offset) break;
                    page++;
                }

                // Internal transactions
                page = 1;
                output.textContent += 'Fetching internal transactions...\n';
                while (true) {
                    output.textContent += `Fetching internal transactions page ${page}...\n`;
                    const params = `module=account&action=txlistinternal&address=${ownerAddr}&startblock=${firstPeriodBlock}&endblock=${endBlock}&page=${page}&offset=${offset}&sort=asc`;
                    const internalTxs = await etherscanCall(params, apiKey);
                    if (!internalTxs || internalTxs.length === 0) {
                        output.textContent += `No more internal transactions on page ${page}.\n`;
                        break;
                    }
                    output.textContent += `Received ${internalTxs.length} internal transactions on page ${page}.\n`;

                    for (const tx of internalTxs) {
                        const valueDec = BigInt(tx.value);
                        output.textContent += `- Hash: ${tx.hash}, From: ${tx.from}, To: ${tx.to}, Value: ${valueDec} wei\n`;

                        if (tx.to && tx.to.toLowerCase() === ownerAddr) {
                            transfersIn += valueDec;
                            output.textContent += `  Incoming: ${weiToXdc(valueDec)} XDC, Running Total In: ${weiToXdc(transfersIn)}\n`;
                        }
                        if (tx.from.toLowerCase() === ownerAddr) {
                            transfersOut += valueDec;
                            output.textContent += `  Outgoing: ${weiToXdc(valueDec)} XDC, Running Total Out: ${weiToXdc(transfersOut)}\n`;
                        }
                    }
                    if (internalTxs.length < offset) break;
                    page++;
                }

                // Calculate rewards
                const netBalanceChange = BigInt(endBalanceDec) - BigInt(startBalanceDec);
                const adjustments = BigInt(transfersIn) - BigInt(transfersOut) - BigInt(totalFees);
                const rewards = netBalanceChange - adjustments;

                output.textContent += '\nFinal Results:\n';
                output.textContent += `Net Balance Change: ${netBalanceChange} wei (${weiToXdc(netBalanceChange)} XDC)\n`;
                output.textContent += `Total Transfers In: ${transfersIn} wei (${weiToXdc(transfersIn)} XDC)\n`;
                output.textContent += `Total Transfers Out: ${transfersOut} wei (${weiToXdc(transfersOut)} XDC)\n`;
                output.textContent += `Total Fees: ${totalFees} wei (${weiToXdc(totalFees)} XDC)\n`;
                output.textContent += `Adjustments (In - Out - Fees): ${adjustments} wei (${weiToXdc(adjustments)} XDC)\n`;
                output.textContent += `Inferred Masternode Rewards from ${startDate} to ${endDate}: ${weiToXdc(rewards)} XDC\n`;
                output.textContent += 'Calculation complete.\n';
            } catch (error) {
                output.textContent += `\nError: ${error.message}\n`;
                console.error(error);
                output.classList.add('error');
            }
            output.scrollTop = output.scrollHeight; // Auto-scroll to bottom
        }

        document.getElementById('inputForm').addEventListener('submit', calculateRewards);
    </script>
</body>
</html>
